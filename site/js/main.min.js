/*! vocab-tree 2014-03-16 */
!function(){function a(){this.indexes=[],this.next=null}app=app||{},app.Search=Backbone.Model.extend({defaults:{words:[]},parseWordsToTree:function(){var b,c,d,e,f=new a,g=this.get("words");for(d=0;d<g.length;d++){for(b=g[d].toLowerCase(),c=f,e=0;e<b.length;e++)c.next||(c.next=[]),c=c.setNextAtIndex(b[e].charCodeAt()-97,d);c.indexes.push(d)}this.set("root",f)},getMatchedWords:function(a){var b=0,c=this.get("root"),d=this.get("words");"undefined"==typeof c&&(this.parseWordsToTree(),c=this.get("root"));for(var e=c,f=a.toLowerCase();b<f.length&&e;)e=e.next?e.next[f[b].charCodeAt()-97]:null,b++;return e?e.indexes.map(function(a){return d[a]}):[]},addWord:function(a){this.get("words").push(a),this.parseWordsToTree()},removeWord:function(a){var b=this.get("words");b.splice(b.indexOf(a),1),this.parseWordsToTree()}}),a.prototype.setNextAtIndex=function(b,c){return this.indexes.push(c),this.next||(this.next=[]),this.next[b]||(this.next[b]=new a),this.next[b]}}();var app=app||{};app.Word=Backbone.Model.extend({defaults:{remembered:!1,synonyms:[]},parse:function(a){return a.id=a._id,a.synonyms=a.synonyms?a.synonyms.split(","):[],a},validate:function(a){return a.name&&a.meaning?void 0:"name and meaning both should be passed"}});var app=app||{};app.Dictionary=Backbone.Collection.extend({url:"api/words",model:app.Word});var app=app||{};app.Game=Backbone.Collection.extend({url:"api/words",model:app.Word}),function(){function a(a){$(a).css({"-webkit-transform":"rotateY(90deg)","-moz-transform":"rotateY(90deg)"}),$(a).siblings().css({"-webkit-transform":"rotateY(90deg)","-moz-transform":"rotateY(90deg)"}),$(a).one("transitionend",function(){$(a).css({"-webkit-transform":"rotateY(180deg)","-moz-transform":"rotateY(180deg)","z-index":0}),$(a).siblings().css({"-webkit-transform":"rotateY(0deg)","-moz-transform":"rotateY(0deg)","z-index":1})})}function b(b){$(".add-word .loading").removeClass("hidden"),c(b,function(b){$(".add-word .loading").addClass("hidden"),$("#meaning").val(b),a($(".add-word .front-face")),$("#meaning").focus()})}function c(a,b){$.ajax({url:"http://glosbe.com/gapi/translate",crossDomain:!0,dataType:"jsonp",data:{from:"eng",dest:"eng",format:"json",phrase:a,page:1,pretty:!0}}).done(function(a){var c;c=a&&"ok"==a.result&&a.tuc?_.pluck(a.tuc[0].meanings.slice(0,4),"text").join("; "):"",b(c)})}function d(){$("#game-wrapper").hide(),$("#wrapper").show()}window.app=app||{},app.DictionaryView=Backbone.View.extend({el:"#wrapper",events:{"click .add-word .front-face":"checkAndFlip","keypress #name":"flipBack","click .add-word .back":"flipFront","click #new-word-btn":"getParams"},initialize:function(){this.$dictionary=this.$el.find("#dictionary"),this.$addWord=this.$el.find(".add-word"),this.collections=new app.Dictionary,this.collections.fetch(),this.searchView=new app.SearchView({model:new app.Search({words:this.collections.pluck("name")})}),this.listenTo(this.collections,"add",this.addWord),this.listenTo(this.collections,"destroy",this.removeWord),this.render()},render:function(a){var b;if(this.$dictionary.html(""),"all"===app.wordType)b=this.collections.models;else{var c="remembered"===app.wordType?!0:!1;b=this.collections.where({remembered:c})}return a&&(a=a.map(function(a){return a.toLowerCase()}),b=b.filter(function(b){return a.indexOf(b.get("name"))+1})),b.map(function(a){this.renderWord(a)},this),d(),this},addWord:function(a){this.renderWord(a),this.searchView.model.addWord(a.get("name"))},removeWord:function(a){this.searchView.model.removeWord(a.get("name"))},renderWord:function(a){var b=new app.WordView({model:a});this.$dictionary.append(b.render().el)},checkAndFlip:function(a){var c=a.originalEvent.srcElement,d=$("#name");return""!==d.val().trim()&&c!==d[0]?(b(d.val().trim()),!1):void 0},flipBack:function(a){13===a.keyCode&&b($("#name").val().trim())},flipFront:function(b){return a($(b.currentTarget).parent()),$("#name").focus(),!1},getParams:function(){var b=$("#name").val().trim(),c=$("#meaning").val().trim(),d=$("#synonyms").val().replace(/\s+/g,"").split(/,|;/).filter(function(a){return""!==a});b&&c&&(this.collections.create({name:b,meaning:c,synonyms:d}),$("#name").val(""),$("#meaning").val(""),$("#synonyms").val(""),a($(".add-word .back-face")))}})}(),function(){function a(a){a.wordPool.length||(a.nextWordPool.length?(a.wordPool=a.nextWordPool,a.nextWordPool=[]):alert("game finished"))}function b(){$("#wrapper").hide(),$("#game-wrapper").show()}window.app=app||{},app.GameView=Backbone.View.extend({el:"#game-wrapper",events:{"click #lg-remembered":"markWordRemembered","click #lg-not-remembered":"markWordNotRemembered","click #lg-next":"showNextWord"},initialize:function(){this.collections=new app.Game;var a=this;this.collections.fetch({success:function(){a.wordPool=a.collections.models.filter(function(a){return!a.get("remembered")}),a.acceptAnswer(!0),a.nextWordPool=[],a.wordPool.length?a.render():alert("There must be a word to start game!!")}}),this.$loopGame=this.$el.find(".loop-game"),this.currentIndex=0,this.$wordContainer=this.$el.find(".word-container"),this.$gameButtons=this.$el.find(".game-option"),this.$nextButton=this.$el.find("#lg-next"),b()},render:function(){var a=this.wordPool[this.currentIndex];return this.wordView&&this.wordView.close(),this.wordView=new app.WordView({model:a}),this.$wordContainer.html(this.wordView.render().$el),this.acceptAnswer(!0),this},markWordRemembered:function(){this.acceptAnswer()&&(this.acceptAnswer(!1),this.wordPool.shift(),a(this),this.showNextWord())},markWordNotRemembered:function(){this.acceptAnswer()&&(this.acceptAnswer(!1),this.nextWordPool.push(this.wordPool.shift()),a(this),this.wordView.flip())},showNextWord:function(){this.wordPool.length&&this.render()},acceptAnswer:function(a){return void 0===a?this.canAnswer:(this.canAnswer=a,this.$gameButtons.toggleClass("active",a),this.$nextButton.toggleClass("active",!a),void 0)}})}();var app=app||{};app.SearchView=Backbone.View.extend({el:"#nav-search",events:{"keyup #word-search":"filterWords"},initialize:function(){this.$input=this.$el.find("#word-search")},filterWords:function(){var a=this.$input.val(),b=this.model.getMatchedWords(a);app.dictionaryView.render(b)}});var app=app||{};app.WordView=Backbone.View.extend({tagName:"section",className:"word-card",template:_.template($("#wordTemplate").html()),events:{"click .front-face":"flip","click .back-face":"flipBack","click .remove":"deleteWord","click .done-mark":"toggleRemembered","click .word label":"pronounceWord","transitionend .front-face":"performRestAnimation"},initialize:function(){this.listenTo(this.model,"change",this.render),this.audio=new Audio},render:function(){return this.$el.html(this.template(this.model.toJSON())).toggleClass("hide",this.isHidden()).find(".meaning").perfectScrollbar({suppressScrollX:!0}),this},deleteWord:function(){this.model.destroy(),this.remove()},close:function(){this.stopListening()},toggleRemembered:function(){return this.model.save({remembered:!this.model.get("remembered")}),!1},pronounceWord:function(){return this.audio.src="https://ssl.gstatic.com/dictionary/static/sounds/de/0/"+this.model.get("name").toLowerCase()+".mp3",this.audio.play(),!1},isHidden:function(){if("all"===app.wordType)return!1;var a=this.model.get("remembered");return a&&"remembered"!==app.wordType||!a&&"remembered"===app.wordType},flip:function(){this.animationType="back",this.$el.find(".front-face").css({"-webkit-transform":"rotateY(90deg)","-moz-transform":"rotateY(90deg)"}),this.$el.find(".back-face").css({"-webkit-transform":"rotateY(270deg)","-moz-transform":"rotateY(270deg)"})},flipBack:function(){this.animationType="front",this.$el.find(".front-face").css({"-webkit-transform":"rotateY(90deg)","-moz-transform":"rotateY(90deg)"}),this.$el.find(".back-face").css({"-webkit-transform":"rotateY(270deg)","-moz-transform":"rotateY(270deg)"})},performRestAnimation:function(){var a,b;"back"===this.animationType?(a=180,b=360,zIndexFront=0,zIndexBack=1):(a=0,b=180,zIndexFront=1,zIndexBack=0),this.$el.find(".front-face").css({"-webkit-transform":"rotateY("+a+"deg)","-moz-transform":"rotateY("+a+"deg)","z-index":zIndexFront}),this.$el.find(".back-face").css({"-webkit-transform":"rotateY("+b+"deg)","-moz-transform":"rotateY("+b+"deg)","z-index":zIndexBack})}}),function(){app=app||{},app.Router=Backbone.Router.extend({routes:{"name/:name":"getWordByName",remembered:"showRemembered",all:"showAll","play/:name":"playGame","*actions":"showToRemember"},getWordByName:function(a){alert("name: "+a)},showRemembered:function(){app.wordType="remembered",app.dictionaryView&&app.dictionaryView.render()},showToRemember:function(){app.wordType="",app.dictionaryView&&app.dictionaryView.render()},showAll:function(){app.wordType="all",app.dictionaryView&&app.dictionaryView.render()},playGame:function(a){new app.GameView({type:a})}});new app.Router;Backbone.history.start()}();var app=app||{};!function(){app.dictionaryView=new app.DictionaryView}();